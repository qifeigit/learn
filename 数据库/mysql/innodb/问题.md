   正常一条写库的时间在10ms以内，而问题开始后一条写库操作在500ms以上。



数据库慢主要是因为io高。因为业务使用了replace语句，replace的原理简单点说就是一次insert和一次delete，频繁的delete会造成mysql内存中有很多脏页，mysql会调用一个page_clean_thread来处理这些脏页。page_clean_thread频繁的被执行导致数据库服务器的io占用，导致运行时间增加。

DBA主要修改了两个参数：1.innodb_page_cleaners由7减少到3；innodb_page_cleaners是进行脏页清理的线程数，

sync_binlog由10增加到400。sync_binlog代表着写磁盘的频率，sync_binlog=400代表500次事务之后才会写一次磁盘；但是风险是如果mysql宕机可能会丢数据。

这两个参数的修改都会减少io的使用从而解决io占用高的问题。





研发上线SQL，修改20张表的表结构，其中一个大表超过20G。数据库为了保证数据的一致性，SQL执行过程中会获取表锁，获取表锁的过程中，和其他执行的事务冲突，引发锁等待，其中两个Slave实例由于锁冲突，造成连接数打满，访问到这两个实例的连接失败。



