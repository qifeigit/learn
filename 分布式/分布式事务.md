## 2pc

prepare 

协调者通知参与者执行事务，但并不提交。参与者返回提交结果

commit 

如果都成功，则提交，否则回滚

问题

同步阻塞

单点问题

网络问题引起的数据不一致

数据库的
xa协议


## seata方案

业务层，无侵入性  


Transaction Coordinator(TC): 
Maintain status of global and branch transactions

Transaction Manager(TM): 

A typical lifecycle of Seata managed distributed transaction:



用户服务的	TM向TC申请开启一个全局事务，全局事务成功并生成一个全局唯一的XID

用户服务的TM向TC注册分支事务，该分支事务在用户服务执行新增用户逻辑，并将其纳入XID对应的全局事务管辖

用户服务执行分支事务

积分服务执行分支事务，执行完毕后，返回用户服务

用户服务分支事务执行完毕

TM向TC发起针对XID的提交或者回滚

TC调度XID管辖的全部分支事务完成提交或者回滚



与传统2pc的差别：

seata在应用层

seata持有锁的时间短




## tcc

try 
做资源的预留
confirm 

确保一定成功

cancel



重试的话需要实现幂等性

实现难度较高




## 可靠消息最终一致性

事务的发起方，异步发送消息给参与方，并保证过程的可靠性


要解决的问题：
1. 本地事务和消息发送的原子性
2. 参与方要保证接受消息的可靠性
3. 保证幂等性
本地消息表（异步确保）//todo




## 最大努力通知

最大努力通知最常见的场景就是支付回调，支付服务收到第三方服务支付成功通知后，先更新自己库中订单支付状态，然后同步通知订单服务支付成功。如果此次同步通知失败，会通过异步脚步不断重试地调用订单服务的接口。